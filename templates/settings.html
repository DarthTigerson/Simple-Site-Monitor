{% extends "layout.html" %}

{% block content %}
<div class="settings-layout">
    <aside class="settings-sidebar">
        <nav>
            <ul>
                <li class="settings-tab-link active" data-tab="general" data-tab-title="General"><span>General</span></li>
                <li class="settings-tab-link" data-tab="webhooks" data-tab-title="Webhooks"><span>Webhooks</span></li>
                <li class="settings-tab-link" data-tab="data" data-tab-title="Data"><span>Data</span></li>
            </ul>
        </nav>
    </aside>
    <main class="settings-main">
        <div class="settings-header">
            <h2 id="settingsPageTitle">General</h2>
            <button type="button" id="saveSettingsBtn" class="btn btn-success">
                <img src="/static/images/save.svg" width="20" height="20" alt="Save" style="filter: brightness(0) invert(1);">
            </button>
        </div>
        <form id="settingsForm">
            <section id="tab-general" class="settings-tab-panel active">
                <div class="settings-card">
                    <div class="settings-card-content">
                        <div class="settings-list">
                            {% for field in [
                                {"id": "scanInterval", "label": "SCAN INTERVAL", "desc": "How often the runner will check site status that doesnt have a set custom scan interval", "value": config.default_scan_interval, "min": 30, "max": 86400, "step": 1, "unit": "seconds"},
                                {"id": "defaultTimeout", "label": "TIMEOUT", "desc": "The maximum amount of time the runner will wait for a site to respond before flagging it as down", "value": config.default_timeout, "min": 10, "max": 300, "step": 1, "unit": "seconds"},
                                {"id": "slowThreshold", "label": "SLOW THRESHOLD", "desc": "If a site surpasses this threshold, it will be flagged as slow", "value": config.default_slow_threshold, "min": 0.5, "max": 300, "step": 0.5, "unit": "seconds"},
                                {"id": "expiringTokenThreshold", "label": "EXPIRING TOKEN THRESHOLD", "desc": "If enabled, the runner will show warnings if the token is expiring soon", "value": config.expiring_token_threshold, "min": 1, "max": 60, "step": 1, "unit": "days"},
                                {"id": "attemptBeforeTrigger", "label": "ATTEMPT BEFORE TRIGGER", "desc": "The number of attempts before the runner will trigger a down alert", "value": config.attempt_before_trigger, "min": 1, "max": 999, "step": 1, "unit": "attempts"}
                            ] %}
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label for="{{ field.id }}">{{ field.label }}</label>
                                    <p class="setting-description">{{ field.desc }}</p>
                                </div>
                                <div class="setting-control">
                                    <div class="number-input-container">
                                        <button type="button" class="number-decrement" onclick="this.nextElementSibling.stepDown(); this.nextElementSibling.dispatchEvent(new Event('change'))">-</button>
                                        <input type="number" id="{{ field.id }}" name="{{ field.id }}" value="{{ field.value }}" min="{{ field.min }}" max="{{ field.max }}" step="{{ field.step }}" required>
                                        <button type="button" class="number-increment" onclick="this.previousElementSibling.stepUp(); this.previousElementSibling.dispatchEvent(new Event('change'))">+</button>
                                    </div>
                                    <span class="unit-label">{{ field.unit }}</span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </section>
            <section id="tab-webhooks" class="settings-tab-panel">
                <div class="settings-card">
                    <div class="settings-card-header"><h3>Webhooks</h3></div>
                    <div class="settings-card-content">
                        <div class="settings-subcards">
                            <div class="settings-subcard webhook-controls-card">
                                <div class="form-group">
                                    <label>WEBHOOK STATUS</label>
                                    <p class="setting-description">Enable or disable webhook notifications</p>
                                    <div class="webhook-toggle-container">
                                        <button type="button" id="webhookToggleBtn" class="btn webhook-toggle {% if config.webhooks and config.webhooks.enabled %}enabled{% else %}disabled{% endif %}">
                                            {% if config.webhooks and config.webhooks.enabled %}Webhook Enabled{% else %}Webhook Disabled{% endif %}
                                        </button>
                                        <input type="hidden" id="webhookEnabled" name="webhookEnabled" value="{% if config.webhooks and config.webhooks.enabled %}true{% else %}false{% endif %}">
                                    </div>
                                </div>
                            </div>
                            {% if config.webhooks and config.webhooks.enabled %}
                            <div class="settings-subcard webhook-details-card">
                            {% else %}
                            <div class="settings-subcard webhook-details-card" style="display:none;">
                            {% endif %}
                                <div class="form-group">
                                    <label for="includeErrorDebugging">LEVEL OF DETAIL</label>
                                    <p class="setting-description">Select the level of details to be included in triggered notifications</p>
                                    <div class="debug-toggle-container">
                                        <button type="button" id="debugToggleBtn" class="btn debug-toggle {% if config.include_error_debugging %}enabled{% else %}disabled{% endif %}">
                                            {% if config.include_error_debugging %}Error Details Included{% else %}Simple Details{% endif %}
                                        </button>
                                        <input type="hidden" id="includeErrorDebugging" name="includeErrorDebugging" value="{{ 'true' if config.include_error_debugging else 'false' }}">
                                    </div>
                                </div>
                            </div>
                            {% if config.webhooks and config.webhooks.enabled %}
                            <div class="settings-subcard webhook-url-card">
                            {% else %}
                            <div class="settings-subcard webhook-url-card" style="display:none;">
                            {% endif %}
                                <div class="form-group">
                                    <label for="webhookUrl">WEBHOOK URL</label>
                                    <p class="setting-description">Enter a webhook URL to receive notifications when a site goes down or returns online</p>
                                    <div class="webhook-form">
                                        <div class="webhook-url">
                                            <input type="url" id="webhookUrl" name="webhookUrl" value="{{ config.webhooks.url if config.webhooks and config.webhooks|length > 0 else '' }}" placeholder="Enter webhook URL (Discord, Slack, or Teams)" {% if not config.webhooks or not config.webhooks.enabled %}disabled{% endif %}>
                                        </div>
                                        <button type="button" id="testWebhookBtn" class="btn webhook-test" title="Test Webhook" 
                                            {% if not config.webhooks or not config.webhooks.enabled %}
                                            disabled
                                            {% endif %}
                                        >
                                            <svg fill="currentColor" height="18" width="18" viewBox="0 0 24 24">
                                                <path d="M23,24H1v-4.3l7-12V2H6V0h12v2h-2v5.7l7,12V24z M12,22h9v-1.7l-3.4-5.9l0,0c-2.6-1.5-3.9-0.8-5.4-0.1S9,15.7,6.5,14.5 l-3.4,5.9V22H12z M7.4,12.7C9,13.4,10,13,11.3,12.4c1.2-0.5,2.7-1.2,4.7-0.7l-2-3.4V2h-4v6.3L7.4,12.7z"></path>
                                                <circle cx="14.5" cy="17.5" r="1.5"></circle>
                                                <circle cx="9.5" cy="18.5" r="1.5"></circle>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section id="tab-data" class="settings-tab-panel">
                <div class="settings-card">
                    <div class="settings-card-header"><h3>Data</h3></div>
                    <div class="settings-card-content">
                        <div class="settings-subcards">
                            <div class="settings-subcard">
                                <div class="form-group">
                                    <label for="configData">CONFIGURATION DATA</label>
                                    <p class="setting-description">Import or export your application configuration file. This includes all settings and site configurations.</p>
                                    <div class="actions-container" style="margin-top: 10px; display: flex; gap: 10px; justify-content: center;">
                                        <button type="button" id="importConfigBtn" class="btn btn-primary" style="background-color: #4b6cb7; color: white; padding: 10px 15px; border-radius: 5px;">
                                            <img src="/static/images/upload.svg" width="16" height="16" alt="Import" style="filter: brightness(0) invert(1); margin-right: 5px;">
                                            Import
                                        </button>
                                        <button type="button" id="exportConfigBtn" class="btn btn-secondary" style="background-color: #6c757d; color: white; padding: 10px 15px; border-radius: 5px;">
                                            <img src="/static/images/download.svg" width="16" height="16" alt="Export" style="filter: brightness(0) invert(1); margin-right: 5px;">
                                            Export
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </form>
    </main>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/settings.js"></script>
{% endblock %} 